<html>

<head>
    <script src="https://unpkg.com/peerjs@1.3.2/dist/peerjs.min.js"></script>
</head>

<body>
    <script>
        navigator.mediaDevices = navigator.mediaDevices || ((navigator.mozGetUserMedia || navigator.webkitGetUserMedia) ? {
            getUserMedia: function (c) {
                return new Promise(function (y, n) {
                    (navigator.mozGetUserMedia ||
                        navigator.webkitGetUserMedia).call(navigator, c, y, n);
                });
            }
        } : null);

        if (!navigator.mediaDevices) {
            console.log("getUserMedia() not supported.");
        };

        // Prefer camera resolution nearest to 1280x720.

        var constraints = { audio: true, video: { width: 1280, height: 720 } };

        var mediaStream;
        navigator.mediaDevices.getUserMedia(constraints)
            .then(function (stream) {
                var video = document.querySelector('video');
                mediaStream = stream;
                video.srcObject = stream;
                video.onloadedmetadata = function (e) {
                    video.play();
                };
            })
            .catch(function (err) {
                console.log(err.name + ": " + err.message);
            });

        const peer = new Peer();

        peer.on('open', function (id) {
            console.log('My peer ID is: ' + id);
        });

        var destId;

        // Call a peer, providing our mediaStream
        var call = peer.call(destId, mediaStream);

        peer.on('call', function (call) {
            // Answer the call, providing our mediaStream
            call.answer(mediaStream);
        });
    </script>
</body>

</html>